import{c as U,r as y,_ as Y,q as R,V as Z,x as d,y as u,z as t,L as $,R as k,J as j,P as b,C as M,Y as q,O as C,T as W,K as T,aq as S,aY as X,Q as z,aV as L,ac as D,o as ee,av as te,aZ as ae,D as se}from"./vue-vendor-DMOLwvvm.js";import{_ as re,u as E,l as ne,s as _,m as oe}from"./index-UbVhXwtH.js";import{L as le}from"./LogoTitle-HCWhCZ0l.js";import{T as ie}from"./ThemeToggle-DaWPUuX9.js";import{C as de}from"./ConfirmModal-DXiBIW2b.js";import"./vendor-CSA95d8J.js";import"./element-plus-BS6u3EDt.js";const ue={class:"glass-strong mb-4 rounded-xl p-3 shadow-xl sm:mb-6 sm:rounded-2xl sm:p-4 md:mb-8 md:rounded-3xl md:p-6",style:{"z-index":"10",position:"relative"}},ce={class:"flex flex-col items-center justify-between gap-3 sm:flex-row sm:gap-4"},me={class:"flex w-full items-center justify-center gap-2 sm:w-auto sm:justify-start sm:gap-3 md:gap-4"},ge={class:"flex items-center gap-1 sm:gap-2"},fe={class:"font-mono text-xs text-gray-400 dark:text-gray-500 sm:text-sm"},pe=["href"],xe={class:"flex items-center gap-2 sm:gap-4"},ve={class:"flex items-center"},ye={class:"user-menu-container relative"},be={class:"hidden sm:inline"},he={class:"border-b border-gray-100 px-4 py-3 dark:border-gray-700"},ke={class:"flex items-center justify-between text-sm"},we={class:"font-mono text-gray-700 dark:text-gray-300"},Ce={key:0,class:"mt-2"},_e={class:"mb-2 flex items-center justify-between text-sm"},Ue={class:"font-mono text-green-600 dark:text-green-400"},Pe=["href"],Ie={key:1,class:"mt-2 text-center text-xs text-gray-500 dark:text-gray-400"},Te={key:2,class:"mt-2 text-center"},Me={key:"message",class:"inline-block rounded-lg border border-green-200 bg-green-100 px-3 py-1.5 dark:border-green-800 dark:bg-green-900/30"},Ne={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},Ae={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-md flex-col p-4 sm:p-6 md:p-8"},$e=["value"],Se={class:"relative"},ze=["type"],Ee={class:"flex gap-3 pt-4"},Ve=["disabled"],je={key:0,class:"loading-spinner mr-2"},qe={key:1,class:"fas fa-save mr-2"},De={__name:"AppHeader",setup(P){const f=L(),p=E(),g=U(()=>p.user||{username:"Admin"}),i=U(()=>p.oemSettings||{}),r=U(()=>p.oemLoading),a=y({current:"...",latest:"",hasUpdate:!1,checkingUpdate:!1,lastChecked:null,releaseInfo:null,noUpdateMessage:!1}),x=y(!1),c=y(!1),o=y(!1),l=y(!1),s=Y({currentPassword:"",newPassword:"",confirmPassword:"",newUsername:""}),I=y(!1),w=y({title:"",message:"",type:"primary",confirmText:"Confirmar",cancelText:"Cancelar"}),h=y(null),K=(n,e,v="Confirmar",m="Cancelar",G="primary")=>new Promise(H=>{w.value={title:n,message:e,confirmText:v,cancelText:m,type:G},h.value=H,I.value=!0}),O=()=>{var n;I.value=!1,(n=h.value)==null||n.call(h,!0)},F=()=>{var n;I.value=!1,(n=h.value)==null||n.call(h,!1)},N=async()=>{if(!a.value.checkingUpdate){a.value.checkingUpdate=!0;try{const n=await ne();if(n.success){const e=n.data;a.value.current=e.current,a.value.latest=e.latest,a.value.hasUpdate=e.hasUpdate,a.value.releaseInfo=e.releaseInfo,a.value.lastChecked=new Date,localStorage.setItem("versionInfo",JSON.stringify({current:e.current,latest:e.latest,lastChecked:a.value.lastChecked,hasUpdate:e.hasUpdate,releaseInfo:e.releaseInfo})),e.hasUpdate||(a.value.noUpdateMessage=!0,setTimeout(()=>{a.value.noUpdateMessage=!1},3e3))}}catch(n){console.error("Error checking for updates:",n);const e=localStorage.getItem("versionInfo");if(e){const v=JSON.parse(e);a.value.current=v.current||a.value.current,a.value.latest=v.latest,a.value.hasUpdate=v.hasUpdate,a.value.releaseInfo=v.releaseInfo,a.value.lastChecked=new Date(v.lastChecked)}}finally{a.value.checkingUpdate=!1}}},B=()=>{s.currentPassword="",s.newPassword="",s.confirmPassword="",s.newUsername="",c.value=!0,x.value=!1},A=()=>{c.value=!1},J=async()=>{if(s.newPassword!==s.confirmPassword){_("两vecesEntradaContraseña不一致","error");return}if(s.newPassword.length<8){_("新Contraseña长度a少8位","error");return}o.value=!0;try{const n=await oe({currentPassword:s.currentPassword,newPassword:s.newPassword,newUsername:s.newUsername||void 0});if(n.success){const e=s.newUsername?"CuentaInformación修改Exitoso，请重新Iniciar sesión":"Contraseña修改Exitoso，请重新Iniciar sesión";_(e,"success"),A(),setTimeout(()=>{p.logout(),f.push("/login")},1500)}else _(n.message||"修改Fallido","error")}catch{_("修改ContraseñaFallido","error")}finally{o.value=!1}},Q=async()=>{await K("退出Iniciar sesión","Confirmar要退出Iniciar sesión吗？","Confirmar退出","Cancelar","warning")&&(p.logout(),f.push("/login"),_("已安全退出","success")),x.value=!1},V=n=>{!n.target.closest(".user-menu-container")&&x.value&&(x.value=!1)};return R(()=>{N(),setInterval(()=>{N()},36e5),document.addEventListener("click",V)}),Z(()=>{document.removeEventListener("click",V)}),(n,e)=>{var v;return u(),d(z,null,[t("div",ue,[t("div",ce,[t("div",me,[k(le,{loading:r.value,"logo-src":i.value.siteIconData||i.value.siteIcon,subtitle:"Panel de Administración",title:i.value.siteName,"title-class":"text-white dark:text-gray-100"},{"after-title":j(()=>{var m;return[t("div",ge,[t("span",fe,"v"+b(a.value.current||"..."),1),a.value.hasUpdate?(u(),d("a",{key:0,class:"inline-flex animate-pulse items-center gap-1 rounded-full border border-green-600 bg-green-500 px-2 py-0.5 text-xs text-white transition-colors hover:bg-green-600",href:((m=a.value.releaseInfo)==null?void 0:m.htmlUrl)||"#",target:"_blank",title:"Actualización disponible"},e[8]||(e[8]=[t("i",{class:"fas fa-arrow-up text-[10px]"},null,-1),t("span",null,"Actualización",-1)]),8,pe)):$("",!0)])]}),_:1},8,["loading","logo-src","title"])]),t("div",xe,[t("div",ve,[k(ie,{mode:"dropdown"})]),e[19]||(e[19]=t("div",{class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},null,-1)),t("div",ye,[t("button",{class:"user-menu-button flex items-center gap-2 rounded-2xl px-3 py-2 text-sm font-semibold text-white shadow-lg transition-all duration-200 hover:scale-105 hover:shadow-xl active:scale-95 sm:px-4 sm:py-2.5",onClick:e[0]||(e[0]=m=>x.value=!x.value)},[e[9]||(e[9]=t("i",{class:"fas fa-user-circle text-sm sm:text-base"},null,-1)),t("span",be,b(g.value.username||"Admin"),1),t("i",{class:M(["fas fa-chevron-down ml-1 text-xs transition-transform duration-200",{"rotate-180":x.value}])},null,2)]),x.value?(u(),d("div",{key:0,class:"user-menu-dropdown absolute right-0 top-full mt-2 w-48 rounded-xl border border-gray-200 bg-white py-2 shadow-xl dark:border-gray-700 dark:bg-gray-800 sm:w-56",style:{"z-index":"999999"},onClick:e[2]||(e[2]=q(()=>{},["stop"]))},[t("div",he,[t("div",ke,[e[10]||(e[10]=t("span",{class:"text-gray-500 dark:text-gray-400"},"Versión actual",-1)),t("span",we,"v"+b(a.value.current||"..."),1)]),a.value.hasUpdate?(u(),d("div",Ce,[t("div",_e,[e[11]||(e[11]=t("span",{class:"font-medium text-green-600 dark:text-green-400"},[t("i",{class:"fas fa-arrow-up mr-1"}),C("Actualización disponible ")],-1)),t("span",Ue,"v"+b(a.value.latest),1)]),t("a",{class:"block w-full rounded-lg bg-green-500 px-3 py-1.5 text-center text-sm text-white transition-colors hover:bg-green-600",href:((v=a.value.releaseInfo)==null?void 0:v.htmlUrl)||"#",target:"_blank"},e[12]||(e[12]=[t("i",{class:"fas fa-external-link-alt mr-1"},null,-1),C("Ver actualización ",-1)]),8,Pe)])):a.value.checkingUpdate?(u(),d("div",Ie,e[13]||(e[13]=[t("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),C("Buscando actualizaciones... ",-1)]))):(u(),d("div",Te,[k(W,{mode:"out-in",name:"fade"},{default:j(()=>[a.value.noUpdateMessage?(u(),d("div",Me,e[14]||(e[14]=[t("p",{class:"text-xs font-medium text-green-700 dark:text-green-400"},[t("i",{class:"fas fa-check-circle mr-1"}),C("当anterior已是最新版本 ")],-1)]))):(u(),d("button",{key:"button",class:"text-xs text-blue-500 transition-colors hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",onClick:e[1]||(e[1]=m=>N())},e[15]||(e[15]=[t("i",{class:"fas fa-sync-alt mr-1"},null,-1),C("检查Actualizar ",-1)])))]),_:1})]))]),t("button",{class:"flex w-full items-center gap-3 px-4 py-3 text-left text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:B},e[16]||(e[16]=[t("i",{class:"fas fa-key text-blue-500"},null,-1),t("span",null,"修改CuentaInformación",-1)])),e[18]||(e[18]=t("hr",{class:"my-2 border-gray-200 dark:border-gray-700"},null,-1)),t("button",{class:"flex w-full items-center gap-3 px-4 py-3 text-left text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:Q},e[17]||(e[17]=[t("i",{class:"fas fa-sign-out-alt text-red-500"},null,-1),t("span",null,"退出Iniciar sesión",-1)]))])):$("",!0)])])])]),c.value?(u(),d("div",Ne,[t("div",Ae,[t("div",{class:"mb-6 flex items-center justify-between"},[e[21]||(e[21]=t("div",{class:"flex items-center gap-3"},[t("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-blue-500 to-blue-600"},[t("i",{class:"fas fa-key text-white"})]),t("h3",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"修改CuentaInformación")],-1)),t("button",{class:"text-gray-400 transition-colors hover:text-gray-600 dark:hover:text-gray-300",onClick:A},e[20]||(e[20]=[t("i",{class:"fas fa-times text-xl"},null,-1)]))]),t("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-6",onSubmit:q(J,["prevent"])},[t("div",null,[e[22]||(e[22]=t("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"当anteriorNombre de usuario",-1)),t("input",{class:"form-input w-full cursor-not-allowed bg-gray-100 dark:bg-gray-700 dark:text-gray-300",disabled:"",type:"text",value:g.value.username||"Admin"},null,8,$e),e[23]||(e[23]=t("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 当anteriorNombre de usuario，Entrada新Nombre de usuario以修改 ",-1))]),t("div",null,[e[24]||(e[24]=t("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"新Nombre de usuario",-1)),T(t("input",{"onUpdate:modelValue":e[3]||(e[3]=m=>s.newUsername=m),class:"form-input w-full",placeholder:"Entrada新Nombre de usuario（留空保持不变）",type:"text"},null,512),[[S,s.newUsername]]),e[25]||(e[25]=t("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},"留空表示不修改Nombre de usuario",-1))]),t("div",null,[e[26]||(e[26]=t("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"当anteriorContraseña",-1)),t("div",Se,[T(t("input",{"onUpdate:modelValue":e[4]||(e[4]=m=>s.currentPassword=m),class:"form-input w-full pr-10",placeholder:"Ingrese当anteriorContraseña",required:"",type:l.value?"text":"password"},null,8,ze),[[X,s.currentPassword]]),t("button",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",type:"button",onClick:e[5]||(e[5]=m=>l.value=!l.value)},[t("i",{class:M(l.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),t("div",null,[e[27]||(e[27]=t("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"新Contraseña",-1)),T(t("input",{"onUpdate:modelValue":e[6]||(e[6]=m=>s.newPassword=m),class:"form-input w-full",placeholder:"Ingrese新Contraseña",required:"",type:"password"},null,512),[[S,s.newPassword]]),e[28]||(e[28]=t("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},"Contraseña长度a少8位",-1))]),t("div",null,[e[29]||(e[29]=t("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"Confirmar新Contraseña",-1)),T(t("input",{"onUpdate:modelValue":e[7]||(e[7]=m=>s.confirmPassword=m),class:"form-input w-full",placeholder:"请再vecesEntrada新Contraseña",required:"",type:"password"},null,512),[[S,s.confirmPassword]])]),t("div",Ee,[t("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:A}," Cancelar "),t("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:o.value,type:"submit"},[o.value?(u(),d("div",je)):(u(),d("i",qe)),C(" "+b(o.value?"Guardaren...":"Guardar修改"),1)],8,Ve)])],32)])])):$("",!0),k(de,{"cancel-text":w.value.cancelText,"confirm-text":w.value.confirmText,message:w.value.message,show:I.value,title:w.value.title,type:w.value.type,onCancel:F,onConfirm:O},null,8,["cancel-text","confirm-text","message","show","title","type"])],64)}}},Le=re(De,[["__scopeId","data-v-ab5cb47b"]]),Ke={class:"mb-4 sm:mb-6"},Oe={class:"block rounded-xl bg-white/10 p-2 backdrop-blur-sm dark:bg-gray-800/20 sm:hidden"},Fe=["value"],Be=["value"],Je={class:"hidden flex-wrap gap-2 rounded-2xl bg-white/10 p-2 backdrop-blur-sm dark:bg-gray-800/20 sm:flex"},Qe=["onClick"],Ge={class:"hidden md:inline"},He={class:"md:hidden"},Ye={__name:"TabBar",props:{activeTab:{type:String,required:!0}},emits:["tab-change"],setup(P){const f=E(),p=U(()=>{var i;const g=[{key:"dashboard",name:"Panel",shortName:"Panel",icon:"fas fa-tachometer-alt"},{key:"apiKeys",name:"API Keys",shortName:"API",icon:"fas fa-key"},{key:"accounts",name:"Cuentas",shortName:"Cuentas",icon:"fas fa-user-circle"},{key:"quotaCards",name:"Tarjetas de cupo",shortName:"Cupos",icon:"fas fa-ticket-alt"}];return(i=f.oemSettings)!=null&&i.ldapEnabled&&g.push({key:"userManagement",name:"Usuarios",shortName:"Usuarios",icon:"fas fa-users"}),g.push({key:"settings",name:"Configuración",shortName:"Config",icon:"fas fa-cogs"}),g});return(g,i)=>(u(),d("div",Ke,[t("div",Oe,[t("select",{class:"focus:ring-primary-color w-full rounded-lg bg-white/90 px-4 py-3 font-semibold text-gray-700 focus:outline-none focus:ring-2 dark:bg-gray-800/90 dark:text-gray-200 dark:focus:ring-indigo-400",value:P.activeTab,onChange:i[0]||(i[0]=r=>g.$emit("tab-change",r.target.value))},[(u(!0),d(z,null,D(p.value,r=>(u(),d("option",{key:r.key,value:r.key},b(r.name),9,Be))),128))],40,Fe)]),t("div",Je,[(u(!0),d(z,null,D(p.value,r=>(u(),d("button",{key:r.key,class:M(["tab-btn flex-1 px-3 py-2 text-xs font-semibold transition-all duration-300 sm:px-4 sm:py-3 sm:text-sm md:px-6",P.activeTab===r.key?"active":"text-gray-700 hover:bg-white/10 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-gray-700/30 dark:hover:text-gray-100"]),onClick:a=>g.$emit("tab-change",r.key)},[t("i",{class:M(r.icon+" mr-1 sm:mr-2")},null,2),t("span",Ge,b(r.name),1),t("span",He,b(r.shortName||r.name),1)],10,Qe))),128))])]))}},Re={class:"min-h-screen p-3 sm:p-4 md:p-6"},Ze={class:"glass-strong rounded-xl p-3 shadow-xl sm:rounded-2xl sm:p-4 md:rounded-3xl md:p-6",style:{"z-index":"1","min-height":"calc(100vh - 120px)"}},We={class:"tab-content"},ot={__name:"MainLayout",setup(P){const f=ae(),p=L(),g=E(),i=y("dashboard"),r=U(()=>{var o;const c={dashboard:"/dashboard",apiKeys:"/api-keys",accounts:"/accounts",quotaCards:"/quota-cards",settings:"/settings"};return(o=g.oemSettings)!=null&&o.ldapEnabled&&(c.userManagement="/user-management"),c}),a=()=>{const c=f.path,o=Object.keys(r.value).find(l=>r.value[l]===c);if(o)i.value=o;else{const l=f.name,s={Dashboard:"dashboard",ApiKeys:"apiKeys",Accounts:"accounts",QuotaCards:"quotaCards",Settings:"settings"};l&&s[l]?i.value=s[l]:i.value="dashboard"}};a(),ee(()=>f.path,c=>{const o=Object.keys(r.value).find(l=>r.value[l]===c);if(o)i.value=o;else{const l=f.name,s={Dashboard:"dashboard",ApiKeys:"apiKeys",Accounts:"accounts",QuotaCards:"quotaCards",Tutorial:"tutorial",Settings:"settings"};l&&s[l]&&(i.value=s[l])}});const x=async c=>{if(r.value[c]!==f.path){i.value=c;try{await p.push(r.value[c]),await se()}catch(o){o.name!=="NavigationDuplicated"&&(console.error("路由切换Fallido:",o),a())}}};return(c,o)=>{const l=te("router-view");return u(),d("div",Re,[k(Le),t("div",Ze,[k(Ye,{"active-tab":i.value,onTabChange:x},null,8,["active-tab"]),t("div",We,[k(l)])])])}}};export{ot as default};
